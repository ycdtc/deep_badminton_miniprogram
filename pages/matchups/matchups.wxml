<view class="container">
    <!-- Tab Bar -->
    <view class="tab-bar">
        <view class="tab {{activeTab === 'matches' ? 'active' : ''}}" bindtap="switchTab" data-tab="matches">å¯¹é˜µè¡¨</view>
        <view class="tab {{activeTab === 'rankings' ? 'active' : ''}}" bindtap="switchTab" data-tab="rankings">æ’è¡Œæ¦œ</view>
    </view>

    <!-- å¯¹é˜µè¡¨è§†å›¾ -->
    <block wx:if="{{activeTab === 'matches'}}">
        <view class="header">
            <text class="title">ğŸ¸ å¯¹é˜µå®‰æ’ ğŸ¸</text>
        </view>

        <view class="matchups-container">
            <block wx:for="{{matches}}" wx:key="index">
                <!-- åªåœ¨æ¯è½®ç¬¬ä¸€åœºæ¯”èµ›æ—¶æ˜¾ç¤ºè½®æ¬¡æ ‡é¢˜ -->
                <view class="round-title" wx:if="{{index === 0 || matches[index-1].round !== item.round}}">
                    ç¬¬{{item.round}}è½®
                </view>

                <!-- æ¯”èµ›å¡ç‰‡ -->
                <view class="match-item" bindtap="editScore" data-match-index="{{index}}">
                    <!-- æ¯”èµ›åºå· -->
                    <view class="match-number">ç¬¬{{item.match}}åœº</view>

                    <!-- æˆ˜åŠ›å€¼æ˜¾ç¤º -->
                    <view class="team-powers">
                        <text class="power-text">æˆ˜æ–—åŠ›: {{item.team1.level}}</text>
                        <text class="power-text">æˆ˜æ–—åŠ›: {{item.team2.level}}</text>
                    </view>

                    <!-- æ¯”åˆ†æ˜¾ç¤º -->
                    <view class="score-display">
                        <view class="team-1">
                            <view class="player-pair">
                                <view class="player" wx:for="{{item.team1.players}}" wx:for-item="player" wx:key="index">
                                    <image class="avatar" src="{{player.avatar || '/images/default-avatar.png'}}" mode="aspectFit"></image>
                                    <text class="name">{{player.name}}</text>
                                </view>
                            </view>
                        </view>

                        <view class="score">
                            <text>{{item.score1 || 0}} : {{item.score2 || 0}}</text>
                        </view>

                        <view class="team-2">
                            <view class="player-pair">
                                <view class="player" wx:for="{{item.team2.players}}" wx:for-item="player" wx:key="index">
                                    <image class="avatar" src="{{player.avatar || '/images/default-avatar.png'}}" mode="aspectFit"></image>
                                    <text class="name">{{player.name}}</text>
                                </view>
                            </view>
                        </view>
                    </view>
                </view>
            </block>
        </view>

        <view class="buttons">
            <button class="secondary-btn" bindtap="regenerateMatches">é‡æ–°ç”Ÿæˆ</button>
        </view>

        <!-- æ·»åŠ åˆ†äº«æŒ‰é’® -->
        <view class="share-button-container" wx:if="{{!shareMode}}">
            <button class="share-button" open-type="share">
                <text class="share-icon">ğŸ”—</text>
                <text>åˆ†äº«å¯¹é˜µè¡¨</text>
            </button>
        </view>

        <!-- åˆ†äº«æ¨¡å¼æç¤º -->
        <view class="share-mode-tip" wx:if="{{shareMode}}">
            <text>ğŸ“¢ æ‚¨æ­£åœ¨æŸ¥çœ‹åˆ†äº«çš„å¯¹é˜µå®‰æ’</text>
        </view>
    </block>

    <!-- æ’è¡Œæ¦œè§†å›¾ -->
    <block wx:if="{{activeTab === 'rankings'}}">
        <view class="header">
            <text class="title">ğŸ† æ’è¡Œæ¦œ ğŸ†</text>
        </view>
        
        <view class="rankings-list">
            <view class="ranking-header">
                <text class="rank-col">æ’å</text>
                <text class="name-col">é€‰æ‰‹</text>
                <text class="stats-col">èƒœåœº</text>
                <text class="stats-col">å‡€èƒœåˆ†</text>
            </view>
            <block wx:for="{{rankings}}" wx:key="index">
                <view class="ranking-item">
                    <text class="rank-col">{{index + 1}}</text>
                    <view class="name-col">
                        <image class="avatar-small" src="{{item.avatar || '/images/default-avatar.png'}}" mode="aspectFit"></image>
                        <text>{{item.name}}</text>
                    </view>
                    <text class="stats-col">{{item.wins}}</text>
                    <text class="stats-col">{{item.pointDiff}}</text>
                </view>
            </block>
        </view>
    </block>
</view>

<!-- è‡ªå®šä¹‰æ¯”åˆ†ç¼–è¾‘å¯¹è¯æ¡† -->
<view class="score-modal-mask" wx:if="{{showScoreModal}}">
    <view class="score-modal">
        <view class="score-modal-title">ç¼–è¾‘æ¯”åˆ†</view>
        <view class="score-modal-content">
            <view class="score-input-container">
                <input class="score-input" type="number" value="{{tempScore1}}" bindinput="onScore1Input" focus="{{scoreModalFocus}}" />
                <view class="score-colon">:</view>
                <input class="score-input" type="number" value="{{tempScore2}}" bindinput="onScore2Input" />
            </view>
        </view>
        <view class="score-modal-buttons">
            <button class="score-modal-button cancel" bindtap="cancelScoreEdit">å–æ¶ˆ</button>
            <button class="score-modal-button confirm" bindtap="confirmScoreEdit">ç¡®å®š</button>
        </view>
    </view>
</view>
